# 永久禁言更新：改為單次 28 天禁言 (2024年6月22日)

## 更新概要

我們修改了第五次及以上違規的禁言處理機制，從之前的模擬永久禁言（28 天並自動續期）改為單次 28 天禁言（不自動續期）。這個更新旨在讓嚴重違規者在禁言期滿後有機會改過，同時仍保持對嚴重違規行為的嚴厲處罰。

## 先前的問題與解決方案

在上一版的實現中（2024年6月21日更新），我們發現：

1. Discord API 存在禁言時間上限（最多 28 天）
2. 為了實現"永久禁言"，我們採用了 28 天禁言並自動續期的方式
3. 這種實現雖然技術上可行，但剝奪了用戶改過的機會

根據新的需求，我們將禁言機制調整為：

1. 第五次及以上違規仍使用 28 天禁言（Discord 允許的最長時間）
2. 禁言到期後不再自動續期，允許用戶在禁言結束後重新參與社群
3. 若用戶在禁言結束後再次違規，仍將獲得 28 天禁言

## 技術變更

已更新以下文件：

1. `app/moderation_db.py`
   - 修改 `calculate_mute_duration` 方法，將第五次違規從返回 `None`（永久）改為返回 28 天
   
2. `app/mute_manager.py`
   - 移除 `timeout_user` 方法中處理 `None` 時間的特殊邏輯
   - 移除 `reapply_permanent_timeouts` 方法及其在 `check_expired_mutes` 中的呼叫
   
3. `app/community_guidelines.py`
   - 更新違規處理說明，將第五次違規的描述從"永久禁言"改為"28 天禁言"

## 比較先前和當前的行為

### 先前行為

- 第五次違規用戶會被禁言 28 天
- 系統會自動檢查並在禁言快到期時重新應用 28 天禁言
- 從用戶角度看，這實際上是一個永久禁言

### 當前行為

- 第五次違規用戶會被禁言 28 天
- 28 天後禁言自動解除，用戶可以重新參與社群
- 若再次違規，將再次獲得 28 天禁言

## 生效時間

此更新立即生效於所有新的違規處理事件。對於現有的永久禁言記錄，它們將不再自動續期，用戶將在當前 28 天禁言結束後恢復權限。 