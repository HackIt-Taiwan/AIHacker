# 通知順序優化更新

日期：2024年6月26日

## 更新內容

為了提高用戶體驗並優化通知流程，我們調整了內容審核和禁言通知的顯示順序。

### 變更摘要

1. **通知順序調整**：
   - 內容審核通知優先顯示，提供違規信息
   - 禁言通知隨後發送，說明處罰結果
   - 兩則通知現在是獨立的，而非內嵌在同一條訊息中

2. **優化用戶體驗**：
   - 讓用戶先了解違規原因，再得知處罰結果
   - 提供更清晰的通知脈絡，增強用戶理解

3. **技術實現改進**：
   - 重構了禁言管理器中的通知機制
   - 分離了禁言邏輯和通知功能，提高靈活性
   - 保留了所有功能，僅調整了執行順序

### 技術實現

1. `app/mute_manager.py`：
   - 修改了 `mute_user` 方法的返回值，增加了 `mute_embed` 參數
   - 禁言管理器不再直接發送通知，而是將通知內容返回給調用者
   - 簽名從 `-> Tuple[bool, str]` 改為 `-> Tuple[bool, str, Optional[discord.Embed]]`

2. `main.py`：
   - 更新了對 `mute_user` 方法返回值的處理邏輯
   - 在內容審核通知發送並確認後，再發送禁言通知
   - 添加了額外的錯誤處理，確保通知穩定性

### 效果對比

#### 舊版流程
1. 用戶發送違規內容
2. 系統同時處理：
   - 刪除違規內容
   - 應用禁言處罰
   - 發送禁言通知
3. 發送內容審核通知（包含禁言處罰信息）

#### 新版流程
1. 用戶發送違規內容
2. 系統處理：
   - 刪除違規內容
   - 應用禁言處罰（但不立即發送通知）
3. 發送內容審核通知
4. 發送獨立的禁言通知

### 預期效果

此更新使通知流程更符合用戶閱讀邏輯，先說明原因再說明結果，幫助用戶理解：
1. 為什麼他們的內容被刪除（內容審核通知）
2. 因此收到了什麼處罰（禁言通知）

兩則獨立通知也有助於用戶按需保存或引用特定通知信息，提升用戶體驗。

## 注意事項

- 此更新不影響禁言功能的實際執行，僅調整通知顯示順序
- 所有的禁言處罰仍立即生效
- 通知內容和格式保持不變，只有顯示順序有所調整 